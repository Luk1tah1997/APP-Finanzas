<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mis Finanzas - MVP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Favicon -->
  <link rel="icon" type="image/jpeg" href="img/logo.png">

  <!-- Manifest PWA -->
  <link rel="manifest" href="manifest.json">

  <!-- Colores de la app en modo standalone -->
  <meta name="theme-color" content="#0f1419">

  <!-- PWA iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="img/icons/icon-192.png">

  <!-- Materialize CSS -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- Estilos propios -->
  <link rel="stylesheet" href="css/styles.css">
</head>

<body>

  <!-- Navbar -->
  <!-- temp-marker -->
  <nav class="no-print">
     <!-- uppercase-test -->
     <div class="nav-wrapper container nav-layout">
      <!-- Izquierda: botón menú -->
      <a href="#!"
        id="btn-sidenav-toggle"
        data-target="slide-out"
        class="sidenav-trigger show-on-large nav-layout__left">
        <i class="material-icons">menu</i>
      </a>

      <!-- Centro: logo con círculo -->
      <div class="nav-layout__center">
        <div class="nav-logo-circle">
          <img src="img/logo.png"
               alt="Mis Finanzas"
               class="nav-logo-img">
        </div>
      </div>

      <!-- Derecha: título -->
      <span class="nav-layout__title">Mis Finanzas</span>
    </div>
  </nav>

  <!-- Menú lateral -->
  <!-- FIX navegación herramientas: eliminado enlace duplicado fuera del sidenav que causaba conflicto de IDs -->
  <ul id="slide-out" class="sidenav">
    <li>
      <a href="#section-tabla" id="nav-toggle-tabla">
        <i class="material-icons">list</i>Movimientos y Filtros
      </a>
    </li>
    <li>
      <a href="#section-dashboard" id="nav-dashboard">
        <i class="material-icons">insert_chart</i>Dashboard
      </a>
    </li>

    <!-- Calendario -->
    <li>
      <a href="#section-calendario" id="nav-calendario">
        <i class="material-icons">event</i>Calendario
      </a>
    </li>

    <!-- Timeline -->
    <li>
      <a href="#section-timeline" id="nav-timeline">
        <i class="material-icons">timeline</i>Timeline
      </a>
    </li>

    <li>
      <a href="#section-herramientas" id="nav-herramientas">
        <i class="material-icons">build</i>Herramientas
      </a>
    </li>

    <li>
      <a href="#section-categorias" id="nav-categorias">
        <i class="material-icons">category</i>Categorías
      </a>
    </li>
    <li><div class="divider"></div></li>
    <li>
      <a href="#!" id="nav-exportar-backup">
        <i class="material-icons">file_download</i>Exportar backup (JSON)
      </a>
    </li>
    <li>
      <a href="#!" id="nav-importar-backup">
        <i class="material-icons">file_upload</i>Importar backup (JSON)
      </a>
    </li>
    <li>
      <a href="#!" id="nav-exportar-csv">
        <i class="material-icons">table_chart</i>Exportar CSV
      </a>
    </li>
    <li>
      <a href="#!" id="nav-exportar-plantilla-excel">
        <i class="material-icons">description</i>Descargar plantilla Excel
      </a>
    </li>
    <li>
      <a href="#!" id="nav-importar-excel">
        <i class="material-icons">upload_file</i>Importar desde Excel
      </a>
    </li>
    <li>
      <a href="#!" id="nav-imprimir">
        <i class="material-icons">print</i>Imprimir / PDF
      </a>
    </li>
    <li><div class="divider"></div></li>
    <li>
      <a href="#!" id="btn-open-config-modal">
        <i class="material-icons">settings</i>Configuración
      </a>
    </li>
  </ul>

  <main class="container">

    <!-- Panel de análisis (período + resumen + dashboard) -->
    <section id="section-dashboard" class="section">
      <h5 class="section-title">Panel de análisis del período</h5>

      <!-- Controles de período -->
      <div class="row period-controls">
        <div class="input-field col s12 m4">
          <select id="filtro-periodo">
            <option value="hoy">Hoy</option>
            <option value="ultimos-7">Una semana (últimos 7 días)</option>
            <option value="mes-actual" selected>Mes actual</option>
            <option value="ultimos-30">Últimos 30 días</option>
            <option value="ultimos-6-meses">Últimos 6 meses</option>
            <option value="anio-actual">Año vigente</option>
            <option value="todo">Todo el histórico</option>
          </select>
          <label for="filtro-periodo">Período rápido</label>
        </div>
        <div class="col s6 m4">
          <label class="date-label">Desde</label>
          <input id="filtro-fecha-desde" type="date" class="date-input">
        </div>
        <div class="col s6 m4">
          <label class="date-label">Hasta</label>
          <input id="filtro-fecha-hasta" type="date" class="date-input">
        </div>
      </div>

      <!-- Resumen del período -->
      <div class="row">
        <div class="col s12 m4">
          <div class="card resumen-card card-ingresos">
            <div class="card-content">
              <span class="card-title">
                <i class="material-icons">trending_up</i>
                Ingresos
              </span>
              <p>
                <span class="currency-symbol" id="resumen-simbolo-ingresos">$</span>
                <span id="total-ingresos">0</span>
              </p>
            </div>
          </div>
        </div>
        <div class="col s12 m4">
          <div class="card resumen-card card-gastos">
            <div class="card-content">
              <span class="card-title">
                <i class="material-icons">trending_down</i>
                Gastos
              </span>
              <p>
                <span class="currency-symbol" id="resumen-simbolo-gastos">$</span>
                <span id="total-gastos">0</span>
              </p>
            </div>
          </div>
        </div>
        <div class="col s12 m4">
          <div class="card resumen-card card-balance">
            <div class="card-content">
              <span class="card-title">
                <i class="material-icons">account_balance_wallet</i>
                Balance
              </span>
              <p>
                <span class="currency-symbol" id="resumen-simbolo-balance">$</span>
                <span id="total-balance">0</span>
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Insights comparativos (mes actual vs anterior) -->
      <div class="row dashboard-insights-row">
        <div class="col s12 m6">
          <div class="card insight-card">
            <div class="card-content">
              <p class="dashboard-insight-line" id="dashboard-insight-ingresos">Cargando datos...</p>
            </div>
          </div>
        </div>
        <div class="col s12 m6">
          <div class="card insight-card">
            <div class="card-content">
              <p class="dashboard-insight-line" id="dashboard-insight-gastos">Cargando datos...</p>
            </div>
          </div>
        </div>
      </div>
      <div class="row dashboard-insights-row">
        <div class="col s12 m6">
          <div class="card insight-card">
            <div class="card-content">
              <p class="dashboard-insight-line" id="dashboard-insight-max-ingreso">Cargando datos...</p>
            </div>
          </div>
        </div>
        <div class="col s12 m6">
          <div class="card insight-card">
            <div class="card-content">
              <p class="dashboard-insight-line" id="dashboard-insight-max-gasto">Cargando datos...</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Métricas rápidas -->
      <div class="row">
        <div class="col s12">
          <div class="card dashboard-card stats-card">
            <div class="card-content">
              <div class="row dashboard-summary">
                <div class="col s12 m4 dashboard-summary-item">
                  <i class="material-icons stats-icon">payments</i>
                  <span class="dashboard-metric-label">Gasto promedio diario</span>
                  <div class="dashboard-metric-value" id="dashboard-gasto-promedio-diario">-</div>
                </div>
                <div class="stats-divider"></div>
                <div class="col s12 m4 dashboard-summary-item">
                  <i class="material-icons stats-icon">calendar_today</i>
                  <span class="dashboard-metric-label">Días con gasto</span>
                  <div class="dashboard-metric-value" id="dashboard-dias-con-gasto">-</div>
                </div>
                <div class="stats-divider"></div>
                <div class="col s12 m4 dashboard-summary-item">
                  <i class="material-icons stats-icon">list_alt</i>
                  <span class="dashboard-metric-label">Cantidad de movimientos</span>
                  <div class="dashboard-metric-value dashboard-movimientos-count">
                    <div class="mov-count-item mov-count-ingresos">
                      <i class="material-icons tiny-icon">arrow_upward</i>
                      <span id="dashboard-cant-mov-ingresos">0</span>
                    </div>
                    <div class="mov-count-item mov-count-gastos">
                      <i class="material-icons tiny-icon">arrow_downward</i>
                      <span id="dashboard-cant-mov-gastos">0</span>
                    </div>
                    <div class="mov-count-item mov-count-total">
                      <span class="mov-count-label">Total</span>
                      <span id="dashboard-cant-mov-total">0</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Gráfico de barras Ingresos vs Gastos -->
      <div class="row">
        <div class="col s12">
          <div class="card dashboard-card">
            <div class="card-content">
              <span class="card-title">Ingresos vs Gastos</span>
              <div class="dashboard-chart-container">
                <canvas id="chart-bar-ingresos-gastos"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Gráfico de línea: balance en el tiempo -->
      <div class="row">
        <div class="col s12">
          <div class="card dashboard-card">
            <div class="card-content">
              <span class="card-title">Balance en el tiempo</span>
              <div class="dashboard-chart-container">
                <canvas id="chart-line-balance-tiempo"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Gráfico de torta: distribución de gastos -->
      <div class="row">
        <div class="col s12">
          <div class="card dashboard-card">
            <div class="card-content">
              <span class="card-title">Distribución de gastos por categoría</span>
              <div class="dashboard-chart-container">
                <canvas id="chart-pie-gastos-categoria"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Gráfico: Ingresos/Gastos por forma de pago -->
      <div class="row">
        <div class="col s12">
          <div class="card dashboard-card">
            <div class="card-content">
              <span class="card-title">Ingresos / Gastos por forma de pago</span>
              <div class="dashboard-chart-container">
                <canvas id="chart-forma-pago"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Calendario -->
    <section id="section-calendario" class="section no-print hide">
      <div class="card calendar-card">
        <div class="card-content">
          <h5 class="section-title">Calendario</h5>
          <div class="calendar-layout row">

            <!-- Columna izquierda: mes + grilla -->
            <div class="col s12 m7 calendar-month-wrapper">

              <!-- Header del mes / año / semana -->
              <div class="calendar-header">
                <button id="btn-calendar-prev"
                        type="button"
                        class="btn-flat waves-effect calendar-nav-btn">
                  <i class="material-icons">chevron_left</i>
                </button>

                <div class="calendar-header-center">
                  <span id="calendar-current-month-label"
                        class="calendar-month-label">
                    <!-- Ej: Marzo 2025 -->
                  </span>
                  <button id="btn-calendar-today"
                          type="button"
                          class="btn-flat waves-effect calendar-today-btn">
                    Hoy
                  </button>
                </div>

                <button id="btn-calendar-next"
                        type="button"
                        class="btn-flat waves-effect calendar-nav-btn">
                  <i class="material-icons">chevron_right</i>
                </button>
              </div>

              <!-- Selector de vista -->
              <div class="calendar-view-row">
                <div class="input-field col s12">
                  <select id="calendar-view-mode">
                    <option value="mes" selected>Mensual</option>
                    <option value="semana">Semanal</option>
                    <option value="anio">Anual</option>
                  </select>
                  <label for="calendar-view-mode">Vista</label>
                </div>
              </div>

              <!-- Cabecera días de la semana -->
              <div class="calendar-weekdays">
                <div class="calendar-weekday">Lu</div>
                <div class="calendar-weekday">Ma</div>
                <div class="calendar-weekday">Mi</div>
                <div class="calendar-weekday">Ju</div>
                <div class="calendar-weekday">Vi</div>
                <div class="calendar-weekday">Sa</div>
                <div class="calendar-weekday">Do</div>
              </div>

              <!-- Grilla (mes, semana o año) -->
              <div id="calendar-grid" class="calendar-grid">
                <!-- Se genera por JS -->
              </div>
            </div>

            <!-- Columna derecha: detalle del día seleccionado -->
            <div class="col s12 m5 calendar-sidebar">

              <!-- Resumen del día -->
              <div class="calendar-day-summary">
                <h6 class="calendar-day-summary-title">
                  Detalle del día
                </h6>
                <p class="calendar-day-summary-date" id="calendar-day-date-label">
                  <!-- Ej: 15 de Marzo de 2025 -->
                </p>

                <div class="calendar-day-totals">
                  <div class="calendar-day-total-item">
                    <span class="calendar-day-total-label">Ingresos</span>
                    <span class="calendar-day-total-value">
                      <span class="currency-symbol calendar-day-simbolo-ingresos">$</span>
                      <span id="calendar-day-total-ingresos">0.00</span>
                    </span>
                  </div>
                  <div class="calendar-day-total-item">
                    <span class="calendar-day-total-label">Gastos</span>
                    <span class="calendar-day-total-value">
                      <span class="currency-symbol calendar-day-simbolo-gastos">$</span>
                      <span id="calendar-day-total-gastos">0.00</span>
                    </span>
                  </div>
                  <div class="calendar-day-total-item">
                    <span class="calendar-day-total-label">Balance</span>
                    <span class="calendar-day-total-value">
                      <span class="currency-symbol calendar-day-simbolo-balance">$</span>
                      <span id="calendar-day-total-balance">0.00</span>
                    </span>
                  </div>
                </div>
              </div>

              <!-- Lista de movimientos del día -->
              <div class="calendar-day-movements">
                <h6 class="calendar-day-movements-title">
                  Movimientos del día
                </h6>

                <ul id="calendar-movimientos-dia" class="collection calendar-movements-list">
                  <!-- Items generados por JS -->
                </ul>

                <p id="calendar-movimientos-empty"
                   class="calendar-movements-empty-text">
                  No hay movimientos para este día.
                </p>
              </div>

            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Timeline de ingresos / gastos / balance -->
    <section id="section-timeline" class="section no-print hide">
      <div class="card timeline-card">
        <div class="card-content">
          <h5 class="section-title">Timeline</h5>

          <!-- Controles -->
          <div class="row timeline-controls">

            <!-- Período -->
            <div class="input-field col s12 m4">
              <select id="timeline-periodo">
                <option value="dia" selected>Día</option>
                <option value="semana">Semana</option>
                <option value="mes">Mes</option>
              </select>
              <label for="timeline-periodo">Agrupar por</label>
            </div>

            <!-- Series a mostrar -->
            <div class="col s12 m8 timeline-series-toggles">
              <span class="timeline-series-label">Series:</span>

              <label class="timeline-series-toggle">
                <input type="checkbox" id="timeline-toggle-ingresos" checked>
                <span>Ingresos</span>
              </label>

              <label class="timeline-series-toggle">
                <input type="checkbox" id="timeline-toggle-gastos" checked>
                <span>Gastos</span>
              </label>

              <label class="timeline-series-toggle">
                <input type="checkbox" id="timeline-toggle-balance" checked>
                <span>Balance</span>
              </label>
            </div>
          </div>

          <!-- Ayuda corta -->
          <p class="timeline-helper-text">
            El timeline usa los movimientos filtrados en la sección de Filtros.
            Cambiá el período o los filtros para explorar distintos rangos.
          </p>

          <!-- Gráfico -->
          <div class="timeline-chart-container">
            <canvas id="chart-timeline"></canvas>
          </div>
        </div>
      </div>
    </section>

    <section id="section-herramientas" class="section">
      <div class="card">
        <div class="card-content">
          <h5 class="section-title">Centro de herramientas</h5>
        </div>
      </div>

      <div class="row">
        <!-- Columna izquierda: menú de herramientas -->
        <div class="col s12 m4">
          <div class="card herramientas-menu">
            <div class="card-content">
              <ul id="herramientas-menu-lista" class="collection">
                <li class="collection-item herramientas-menu-item activa" id="herramienta-item-presupuesto">
                  <i class="material-icons left">attach_money</i>
                  Presupuesto diario
                </li>
                <li class="collection-item herramientas-menu-item" id="herramienta-item-grupal">
                  <i class="material-icons left">group</i>
                  Gastos grupales
                </li>
                <li class="collection-item herramientas-menu-item" id="herramienta-item-divisas">
                  <i class="material-icons left">swap_horiz</i>
                  Conversor de divisas
                </li>
                <li class="collection-item herramientas-menu-item" id="herramienta-item-interes">
                  <i class="material-icons left">trending_up</i>
                  Interés compuesto
                </li>
                <li class="collection-item herramientas-menu-item" id="herramienta-item-objetivo">
                  <i class="material-icons left">flag</i>
                  Objetivo de ahorro
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Columna derecha: paneles de contenido -->
        <div class="col s12 m8">
          <div id="herramientas-contenido">
            <!-- Panel Presupuesto diario -->
            <div id="herramienta-panel-presupuesto">
              <div class="card">
                <div class="card-content">
                  <span class="card-title">Presupuesto diario</span>
                  <p class="grey-text text-darken-1">
                    Calcula cuánto podés gastar por día según el monto disponible y los días restantes.
                  </p>
                  <form id="form-herramienta-presupuesto">
                    <div class="row">
                      <div class="col s12 m6">
                        <div class="input-field">
                          <input id="hp-monto-disponible" type="number" step="0.01" />
                          <label for="hp-monto-disponible">Monto disponible</label>
                        </div>
                      </div>
                      <div class="col s12 m6">
                        <div class="input-field">
                          <input id="hp-dias-restantes" type="number" />
                          <label for="hp-dias-restantes">Días restantes</label>
                        </div>
                      </div>
                    </div>
                    <div class="row no-print">
                      <div class="col s12 m6">
                        <button class="btn waves-effect waves-light btn-full-width" type="submit" id="hp-btn-calcular">Calcular</button>
                      </div>
                      <div class="col s12 m6">
                        <button class="btn grey lighten-1 black-text waves-effect btn-full-width" type="button" id="hp-btn-limpiar">Limpiar</button>
                      </div>
                    </div>
                    <div id="hp-resultado" class="grey-text text-darken-2"></div>
                  </form>
                </div>
              </div>
            </div>

            <!-- Panel Gastos grupales -->
            <div id="herramienta-panel-grupal" style="display:none;">
              <div class="card">
                <div class="card-content">
                  <span class="card-title">Gastos grupales</span>
                  <p class="grey-text text-darken-1">
                    Calcula cuánto debe aportar cada persona en un gasto grupal.
                  </p>
                  <form id="form-herramienta-grupal">
                    <div class="row">
                      <div class="col s12 m6">
                        <div class="input-field">
                          <input id="hg-monto-total" type="number" step="0.01" />
                          <label for="hg-monto-total">Monto total</label>
                        </div>
                      </div>
                      <div class="col s12 m6">
                        <div class="input-field">
                          <input id="hg-cantidad-personas" type="number" />
                          <label for="hg-cantidad-personas">Cantidad de personas</label>
                        </div>
                      </div>
                    </div>
                    <div id="hg-personas-container" class="row" style="display: none;">
                      <div class="col s12">
                        <button class="btn-small waves-effect waves-light" type="button" id="hg-btn-agregar-persona">
                          <i class="material-icons left">person_add</i>
                          Agregar persona
                        </button>
                      </div>
                      <div class="col s12">
                        <div id="hg-personas-lista"></div>
                      </div>
                    </div>
                    <div class="row no-print">
                      <div class="col s12 m6">
                        <button class="btn waves-effect waves-light btn-full-width" type="submit" id="hg-btn-calcular">Calcular</button>
                      </div>
                      <div class="col s12 m6">
                        <button class="btn grey lighten-1 black-text waves-effect btn-full-width" type="button" id="hg-btn-limpiar">Limpiar</button>
                      </div>
                    </div>
                    <div id="hg-resultado" class="grey-text text-darken-2"></div>
                  </form>
                </div>
              </div>
            </div>

            <!-- Panel Conversor de divisas -->
            <div id="herramienta-panel-divisas" style="display:none;">
              <div class="card">
                <div class="card-content">
                  <span class="card-title">Conversor de divisas</span>
                  <form id="form-herramienta-divisas">
                    <div class="row">
                      <div class="col s12 m4">
                        <div class="input-field">
                          <input id="hd-monto" type="number" step="0.01" />
                          <label for="hd-monto">Monto</label>
                        </div>
                      </div>
                      <div class="col s12 m4">
                        <div class="input-field">
                          <select id="hd-moneda-origen">
                            <option value="ARS">ARS</option>
                            <option value="USD">USD</option>
                            <option value="EUR">EUR</option>
                          </select>
                          <label>Moneda origen</label>
                        </div>
                      </div>
                      <div class="col s12 m4">
                        <div class="input-field">
                          <select id="hd-moneda-destino">
                            <option value="USD">USD</option>
                            <option value="ARS">ARS</option>
                            <option value="EUR">EUR</option>
                          </select>
                          <label>Moneda destino</label>
                        </div>
                      </div>
                    </div>
                    <div class="row no-print">
                      <div class="col s12 m6">
                        <button class="btn waves-effect waves-light btn-full-width" type="submit" id="hd-btn-calcular">Calcular</button>
                      </div>
                      <div class="col s12 m6">
                        <button class="btn grey lighten-1 black-text waves-effect btn-full-width" type="button" id="hd-btn-limpiar">Limpiar</button>
                      </div>
                    </div>
                    <div id="hd-resultado" class="grey-text text-darken-2"></div>
                  </form>
                </div>
              </div>
            </div>

            <!-- Panel Interés compuesto -->
            <div id="herramienta-panel-interes" style="display:none;">
              <div class="card">
                <div class="card-content">
                  <span class="card-title">Interés compuesto</span>
                  <form id="form-herramienta-interes">
                    <div class="row">
                      <div class="col s12 m3">
                        <div class="input-field">
                          <input id="hi-monto-inicial" type="number" step="0.01" />
                          <label for="hi-monto-inicial">Monto inicial</label>
                        </div>
                      </div>
                      <div class="col s12 m3">
                        <div class="input-field">
                          <input id="hi-aporte-mensual" type="number" step="0.01" />
                          <label for="hi-aporte-mensual">Aporte mensual</label>
                        </div>
                      </div>
                      <div class="col s12 m3">
                        <div class="input-field">
                          <input id="hi-tasa-anual" type="number" step="0.01" />
                          <label for="hi-tasa-anual">Tasa anual (%)</label>
                        </div>
                      </div>
                      <div class="col s12 m3">
                        <div class="input-field">
                          <input id="hi-plazo-anios" type="number" />
                          <label for="hi-plazo-anios">Plazo (años)</label>
                        </div>
                      </div>
                    </div>
                    <div class="row no-print">
                      <div class="col s12 m6">
                        <button class="btn waves-effect waves-light btn-full-width" type="submit" id="hi-btn-calcular">Calcular</button>
                      </div>
                      <div class="col s12 m6">
                        <button class="btn grey lighten-1 black-text waves-effect btn-full-width" type="button" id="hi-btn-limpiar">Limpiar</button>
                      </div>
                    </div>
                    <div id="hi-resultado" class="grey-text text-darken-2"></div>
                  </form>
                </div>
              </div>
            </div>

            <!-- Panel Objetivo de ahorro -->
            <div id="herramienta-panel-objetivo" style="display:none;">
              <div class="card">
                <div class="card-content">
                  <span class="card-title">Objetivo de ahorro</span>
                  <form id="form-herramienta-objetivo">
                    <div class="row">
                      <div class="col s12 m4">
                        <div class="input-field">
                          <input id="ho-monto-objetivo" type="number" step="0.01" />
                          <label for="ho-monto-objetivo">Monto objetivo</label>
                        </div>
                      </div>
                      <div class="col s12 m4">
                        <div class="input-field">
                          <input id="ho-meses" type="number" />
                          <label for="ho-meses">Meses</label>
                        </div>
                      </div>
                      <div class="col s12 m4">
                        <div class="input-field">
                          <input id="ho-aporte-actual" type="number" step="0.01" />
                          <label for="ho-aporte-actual">Aporte mensual actual (opcional)</label>
                        </div>
                      </div>
                    </div>
                    <div class="row no-print">
                      <div class="col s12 m6">
                        <button class="btn waves-effect waves-light btn-full-width" type="submit" id="ho-btn-calcular">Calcular</button>
                      </div>
                      <div class="col s12 m6">
                        <button class="btn grey lighten-1 black-text waves-effect btn-full-width" type="button" id="ho-btn-limpiar">Limpiar</button>
                      </div>
                    </div>
                    <div id="ho-resultado" class="grey-text text-darken-2"></div>
                  </form>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </section>

    <!-- Sección Categorías -->
    <section id="section-categorias" class="section no-print hide">
      <div class="card">
        <div class="card-content">
          <h5 class="section-title">Categorías</h5>
          <div class="row">
            <div class="col s12 m6">
              <span class="card-title">Ingresos</span>
              <ul id="lista-categorias-ingreso" class="collection">
                <!-- items generados por JS -->
              </ul>
            </div>
            <div class="col s12 m6">
              <span class="card-title">Gastos</span>
              <ul id="lista-categorias-gasto" class="collection">
                <!-- items generados por JS -->
              </ul>
            </div>
          </div>

          <div class="row">
            <form id="form-categoria" class="col s12">
              <div class="row">
                <div class="input-field col s12 m3">
                  <select id="categoria-tipo">
                    <option value="INGRESO" selected>Ingreso</option>
                    <option value="GASTO">Gasto</option>
                  </select>
                  <label for="categoria-tipo">Tipo</label>
                </div>
                <div class="input-field col s12 m5">
                  <input id="categoria-nombre" type="text" required>
                  <label for="categoria-nombre">Nombre de categoría</label>
                </div>
                <div class="input-field col s12 m4">
                  <button id="btn-guardar-categoria"
                          class="btn waves-effect waves-light teal btn-full-width"
                          type="submit">
                    Guardar categoría
                    <i class="material-icons right">save</i>
                  </button>
                </div>
              </div>
            </form>
          </div>

        </div>
      </div>
    </section>

    <!-- Filtros (inicia minimizado) -->
    <!-- Movimientos y Filtros unificados -->
    <section id="section-tabla" class="section">
      <div class="card">
        <div class="card-content">
          <h5 class="section-title">Movimientos</h5>
          
          <!-- Filtros compactos -->
          <div id="section-filtros" class="no-print hide" style="margin-bottom: 1rem;">
            <div class="row" style="margin-bottom: 0.5rem;">
              <div class="input-field col s6 m2">
                <select id="filtro-tipo">
                  <option value="TODOS" selected>Todos</option>
                  <option value="INGRESO">Ingresos</option>
                  <option value="GASTO">Gastos</option>
                </select>
                <label for="filtro-tipo">Tipo</label>
              </div>

              <div class="input-field col s6 m2">
                <select id="filtro-categoria">
                  <option value="TODAS" selected>Todas</option>
                </select>
                <label for="filtro-categoria">Categoría</label>
              </div>

              <div class="input-field col s6 m2">
                <select id="filtro-forma-pago">
                  <option value="TODAS" selected>Todas</option>
                  <option value="Efectivo">Efectivo</option>
                  <option value="Debito">Débito</option>
                  <option value="Credito">Crédito</option>
                  <option value="Transferencia">Transferencia</option>
                  <option value="Crypto">Crypto</option>
                </select>
                <label for="filtro-forma-pago">Forma de pago</label>
              </div>

              <div class="input-field col s6 m3">
                <input id="filtro-monto-min" type="number" step="0.01" min="0">
                <label for="filtro-monto-min">Monto mínimo</label>
              </div>

              <div class="input-field col s6 m3">
                <input id="filtro-monto-max" type="number" step="0.01" min="0">
                <label for="filtro-monto-max">Monto máximo</label>
              </div>
            </div>

            <div class="row" style="margin-bottom: 0;">
              <div class="col s12 m6">
                <button id="btn-aplicar-filtros"
                        class="btn waves-effect waves-light teal btn-full-width"
                        type="button">
                  Aplicar filtros
                  <i class="material-icons right">filter_list</i>
                </button>
              </div>
              <div class="col s12 m6">
                <button id="btn-limpiar-filtros"
                        class="btn-flat waves-effect btn-full-width"
                        type="button">
                  Limpiar filtros
                </button>
              </div>
            </div>
          </div>

          <!-- Tabla de movimientos -->
          <div class="table-wrapper">
            <table class="highlight responsive-table">
            <thead>
            <tr>
              <th>Fecha</th>
              <th>Tipo</th>
              <th>Categoría</th>
              <th>Forma</th>
              <th class="left-align">Monto</th>
              <th>Nota</th>
              <th class="center-align no-print">Acciones</th>
            </tr>
            </thead>
            <tbody id="tabla-movimientos-body">
            <!-- Filas generadas por JS -->
            </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="app-footer no-print">
    <div class="container">
      <span class="footer-app-name">Mis Finanzas</span>
      <span class="footer-divider">·</span>
      <span class="footer-copy">© 2025</span>
      <span class="footer-version">v3.1 PWA</span>
    </div>
  </footer>

  <!-- Botón flotante para nuevo movimiento -->
  <div class="fixed-action-btn no-print">
    <a id="btn-fab-nuevo-mov"
       class="btn-floating btn-large teal">
      <i class="large material-icons">add</i>
    </a>
  </div>

  <!-- Modal de nuevo/editar movimiento -->
  <div id="modal-movimiento" class="modal">
    <div class="modal-content">
      <h5 id="modal-movimiento-titulo">Nuevo movimiento</h5>
      <form id="form-movimiento">

        <div class="row">
          <div class="col s12">
            <p class="label-radio">Tipo de movimiento</p>
            <p>
              <label>
                <input class="with-gap" name="tipo" type="radio" value="INGRESO" checked>
                <span>Ingreso</span>
              </label>
            </p>
            <p>
              <label>
                <input class="with-gap" name="tipo" type="radio" value="GASTO">
                <span>Gasto</span>
              </label>
            </p>
          </div>
        </div>

        <div class="row">
          <div class="input-field col s12 m4">
            <input id="fecha" type="date" required>
            <label for="fecha" class="active">Fecha</label>
          </div>
          <div class="input-field col s12 m4">
            <input id="monto" type="number" step="0.01" min="0" required>
            <label for="monto" class="active">Monto</label>

            <!-- Botones de monto rápido -->
            <div id="monto-quick-actions" class="monto-quick-actions no-print">
              <button type="button"
                      class="btn-small btn-monto-rapido"
                      data-action="add"
                      data-value="1000">
                +1.000
              </button>
              <button type="button"
                      class="btn-small btn-monto-rapido"
                      data-action="add"
                      data-value="5000">
                +5.000
              </button>
              <button type="button"
                      class="btn-small btn-monto-rapido"
                      data-action="add"
                      data-value="10000">
                +10.000
              </button>
              <button type="button"
                      class="btn-small btn-monto-rapido"
                      data-action="copiar-ultimo">
                Copiar último
              </button>
            </div>
          </div>
          <div class="input-field col s12 m4">
            <select id="categoria" required>
              <!-- Opciones generadas por JS -->
            </select>
            <label for="categoria">Categoría</label>

            <!-- Búsqueda de categoría -->
            <div class="categoria-search-wrapper">
              <input id="categoria-busqueda"
                     type="text"
                     placeholder="Buscar categoría...">
            </div>
          </div>
        </div>

        <div class="row">
          <div class="input-field col s12 m4">
            <select id="forma-pago">
              <option value="Efectivo" selected>Efectivo</option>
              <option value="Debito">Débito</option>
              <option value="Credito">Crédito</option>
              <option value="Transferencia">Transferencia</option>
              <option value="Crypto">Crypto</option>
            </select>
            <label for="forma-pago">Forma de pago</label>
          </div>

          <div class="input-field col s12 m8">
            <!-- espacio reservado para futuras opciones -->
          </div>

        </div>

        <div class="row">
          <div class="input-field col s12">
            <textarea id="nota" class="materialize-textarea" rows="2"></textarea>
            <label for="nota">Nota (opcional)</label>
          </div>
        </div>

        <!-- Mensajes de validación dentro del modal -->
        <div class="row">
          <div class="col s12">
            <p id="movimiento-error" class="movimiento-error-text"></p>
          </div>
        </div>

        <div class="row">
          <div class="col s12 right-align">
            <button id="btn-guardar-movimiento"
                    class="btn waves-effect waves-light teal"
                    type="submit">
              Guardar
              <i class="material-icons right">save</i>
            </button>
          </div>
        </div>

      </form>
    </div>
  </div>

  <!-- Modal confirmar eliminación -->
  <div id="modal-eliminar" class="modal">
    <div class="modal-content">
      <h5>Confirmar eliminación</h5>
      <p>¿Seguro que deseas eliminar este movimiento?</p>
      <ul class="collection">
        <li class="collection-item">
          <strong>Fecha:</strong> <span id="modal-eliminar-fecha">-</span>
        </li>
        <li class="collection-item">
          <strong>Tipo:</strong> <span id="modal-eliminar-tipo">-</span>
        </li>
        <li class="collection-item">
          <strong>Categoría:</strong> <span id="modal-eliminar-categoria">-</span>
        </li>
        <li class="collection-item">
          <strong>Monto:</strong>
          <span id="modal-eliminar-moneda">$</span>
          <span id="modal-eliminar-monto">0.00</span>
        </li>
        <li class="collection-item">
          <strong>Nota:</strong> <span id="modal-eliminar-nota">-</span>
        </li>
      </ul>
    </div>
    <div class="modal-footer">
      <a href="#!"
         class="modal-close btn-flat">
        Cancelar
      </a>
      <button id="btn-confirmar-eliminar"
              class="btn red waves-effect waves-light">
        Eliminar
      </button>
    </div>
  </div>

  <!-- Modal renombrar categoría -->
  <div id="modal-renombrar-categoria" class="modal">
    <div class="modal-content">
      <h5>Renombrar categoría</h5>
      <div class="input-field">
        <input id="input-renombrar-categoria"
               type="text"
               class="validate"
               required>
        <label for="input-renombrar-categoria">Nuevo nombre</label>
      </div>
    </div>
    <div class="modal-footer">
      <a href="#!"
         class="modal-close btn-flat">
        Cancelar
      </a>
      <button id="btn-confirmar-renombrar"
              class="btn waves-effect waves-light">
        <i class="material-icons left">edit</i>
        Aceptar
      </button>
    </div>
  </div>

  <!-- Modal de configuración -->
  <div id="modal-config" class="modal">
    <div class="modal-content">
      <h5>Configuración</h5>

      <div class="row">
        <div class="input-field col s12 m4">
          <i class="material-icons prefix">brightness_6</i>
          <select id="config-tema">
            <option value="claro" selected>Tema claro</option>
            <option value="oscuro">Tema oscuro</option>
          </select>
          <label for="config-tema" class="active">Tema</label>
        </div>

        <div class="input-field col s12 m6">
          <i class="material-icons prefix">attach_money</i>
          <select id="config-moneda">
            <option value="$">$ - Pesos</option>
            <option value="US$">US$ - Dólares</option>
            <option value="€">€ - Euros</option>
            <option value="£">£ - Libras</option>
            <option value="¥">¥ - Yuanes</option>
          </select>
          <label for="config-moneda" class="active">Moneda</label>
        </div>
      </div>

      <!-- Vista de calendario preferida -->
      <div class="row">
        <div class="input-field col s12 m4">
          <i class="material-icons prefix">event</i>
          <select id="config-calendario-vista">
            <option value="mes" selected>Mensual</option>
            <option value="semana">Semanal</option>
            <option value="anio">Anual</option>
          </select>
          <label for="config-calendario-vista" class="active">Vista de calendario</label>
        </div>
      </div>

      <!-- Tasas de cambio (para Conversor de divisas) -->
      <div class="row">
        <div class="col s12">
          <p class="grey-text text-darken-1" style="margin-bottom: 0.5rem;">
            Tasas de cambio (base ARS): definí cuántos ARS equivalen a 1 USD/EUR.
          </p>
        </div>
        <div class="input-field col s12 m4">
          <i class="material-icons prefix">currency_exchange</i>
          <input id="config-tasa-usd" type="number" step="0.0001" />
          <label for="config-tasa-usd">1 USD = (en ARS)</label>
        </div>
        <div class="input-field col s12 m4">
          <i class="material-icons prefix">currency_exchange</i>
          <input id="config-tasa-eur" type="number" step="0.0001" />
          <label for="config-tasa-eur">1 EUR = (en ARS)</label>
        </div>
      </div>

      <!-- Qué abrir al iniciar -->
      <div class="row">
        <div class="col s12 m3">
          <label>
            <input id="config-abrir-tabla" type="checkbox" class="filled-in">
            <span><i class="material-icons tiny">table_view</i> Mostrar movimientos al iniciar</span>
          </label>
        </div>
        <div class="col s12 m3">
          <label>
            <input id="config-abrir-filtros" type="checkbox" class="filled-in">
            <span><i class="material-icons tiny">filter_list</i> Mostrar filtros al iniciar</span>
          </label>
        </div>
        <div class="col s12 m3">
          <label>
            <input id="config-abrir-dashboard" type="checkbox" class="filled-in">
            <span><i class="material-icons tiny">insert_chart</i> Mostrar dashboard al iniciar</span>
          </label>
        </div>
        <div class="col s12 m3">
          <label>
            <input id="config-abrir-modal" type="checkbox" class="filled-in">
            <span><i class="material-icons tiny">add_circle</i> Abrir "Nuevo movimiento" al iniciar</span>
          </label>
        </div>
      </div>

      <!-- Abrir calendario / timeline / herramientas al iniciar -->
      <div class="row">
        <div class="col s12 m3">
          <label>
            <input id="config-abrir-calendario" type="checkbox" class="filled-in">
            <span><i class="material-icons tiny">event</i> Mostrar calendario al iniciar</span>
          </label>
        </div>
        <div class="col s12 m3">
          <label>
            <input id="config-abrir-timeline" type="checkbox" class="filled-in">
            <span><i class="material-icons tiny">timeline</i> Mostrar timeline al iniciar</span>
          </label>
        </div>
        <div class="col s12 m3">
          <label>
            <input id="config-abrir-herramientas" type="checkbox" class="filled-in">
            <span><i class="material-icons tiny">build</i> Mostrar herramientas al iniciar</span>
          </label>
        </div>
      </div>

      <div class="row">
        <div class="col s12 m4">
          <label>
            <input id="config-mostrar-iconos" type="checkbox" class="filled-in">
            <span><i class="material-icons tiny">category</i> Mostrar iconos en categorías</span>
          </label>
        </div>
        <div class="col s12 m4">
          <label>
            <input id="config-mostrar-grafico-forma" type="checkbox" class="filled-in">
            <span><i class="material-icons tiny">pie_chart</i> Mostrar gráfico "Formas de pago"</span>
          </label>
        </div>
      </div>
      <!-- Instalación como aplicación móvil (PWA) -->
      <div class="row">
        <div class="col s12 m8">
          <p class="grey-text text-darken-1" style="margin-bottom: 0.5rem;">
            Podés instalar "Mis Finanzas" como app en este dispositivo (Android y navegadores compatibles con PWA).
          </p>
        </div>
        <div class="col s12 m4" style="display: flex; align-items: center; justify-content: flex-end; margin-top: 0.5rem;">
          <button id="btn-instalar-pwa"
                  type="button"
                  class="btn waves-effect waves-light teal">
            <i class="material-icons left">download</i>
            Instalar app
          </button>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <a href="#!"
         class="modal-close btn-flat">
        Cancelar
      </a>
      <button id="btn-guardar-config"
              class="btn waves-effect waves-light teal">
        Guardar
      </button>
    </div>
  </div>

  <!-- Modal Resultado Presupuesto Diario -->
  <div id="modal-resultado-presupuesto" class="modal">
    <div class="modal-content">
      <h5>Resultado: Presupuesto diario</h5>
      <div id="resultado-presupuesto-contenido" class="resultado-herramienta">
        <!-- Generado por JS -->
      </div>
    </div>
    <div class="modal-footer">
      <a href="#!" class="modal-close btn-flat">Cerrar</a>
    </div>
  </div>

  <!-- Modal Resultado Gastos Grupales -->
  <div id="modal-resultado-grupal" class="modal">
    <div class="modal-content">
      <h5>Resultado: Gastos grupales</h5>
      <div id="resultado-grupal-contenido" class="resultado-herramienta">
        <!-- Generado por JS -->
      </div>
    </div>
    <div class="modal-footer">
      <a href="#!" class="modal-close btn-flat">Cerrar</a>
    </div>
  </div>

  <!-- Modal Historial de Herramientas -->
  <div id="modal-historial-herramientas" class="modal modal-fixed-footer">
    <div class="modal-content">
      <h5>Historial de cálculos</h5>
      <div id="historial-herramientas-lista">
        <!-- Generado por JS -->
      </div>
    </div>
    <div class="modal-footer">
      <button id="btn-limpiar-historial" class="btn red left" type="button">
        <i class="material-icons left">delete</i>Limpiar historial
      </button>
      <a href="#!" class="modal-close btn-flat">Cerrar</a>
    </div>
  </div>

  <!-- Modal Opciones de Impresión -->
  <div id="modal-imprimir" class="modal">
    <div class="modal-content">
      <h5>Opciones de impresión</h5>
      <p>Selecciona el período para el reporte:</p>

      <div class="row">
        <div class="col s12">
          <p>
            <label>
              <input name="imp-periodo-modo" type="radio" value="filtros-actuales" checked />
              <span>Usar filtros actuales</span>
            </label>
          </p>
          <p>
            <label>
              <input name="imp-periodo-modo" type="radio" value="periodo-rapido" />
              <span>Período rápido</span>
            </label>
          </p>
          <p>
            <label>
              <input name="imp-periodo-modo" type="radio" value="rango-personalizado" />
              <span>Rango personalizado</span>
            </label>
          </p>
        </div>
      </div>

      <!-- Select de período rápido -->
      <div class="row" id="imp-periodo-rapido-container" style="display: none;">
        <div class="input-field col s12">
          <select id="imp-periodo-rapido">
            <option value="hoy">Hoy</option>
            <option value="ultimos-7">Una semana (últimos 7 días)</option>
            <option value="mes-actual" selected>Mes actual</option>
            <option value="ultimos-30">Últimos 30 días</option>
            <option value="ultimos-6-meses">Últimos 6 meses</option>
            <option value="anio-actual">Año vigente</option>
            <option value="todo">Todo el histórico</option>
          </select>
          <label for="imp-periodo-rapido">Selecciona el período</label>
        </div>
      </div>

      <!-- Inputs de rango personalizado -->
      <div class="row" id="imp-rango-personalizado-container" style="display: none;">
        <div class="col s6">
          <label for="imp-fecha-desde" class="date-label">Desde</label>
          <input id="imp-fecha-desde" type="date" class="date-input">
        </div>
        <div class="col s6">
          <label for="imp-fecha-hasta" class="date-label">Hasta</label>
          <input id="imp-fecha-hasta" type="date" class="date-input">
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <a href="#!" class="modal-close btn-flat">Cancelar</a>
      <button id="btn-confirmar-imprimir" class="btn waves-effect waves-light">
        <i class="material-icons left">print</i>Imprimir
      </button>
    </div>
  </div>

  <!-- Input oculto para importar backup -->
  <input id="input-importar-backup"
         type="file"
         accept="application/json"
         style="display: none;">

  <!-- Input oculto para importar Excel -->
  <input id="input-importar-excel"
         type="file"
         accept=".xlsx,.xls"
         style="display: none;">

  <!-- Materialize JS -->
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js">
  </script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- SheetJS (para Excel) -->
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

  <!-- JS modularizado -->
  <script src="js/core.js"></script>
  <script src="js/config.js"></script>
  <script src="js/categorias.js"></script>
  <script src="js/movimientos.js"></script>
  <script src="js/filtros.js"></script>
  <script src="js/dashboard.js"></script>
  <script src="js/timeline.js"></script>
  <script src="js/calendario.js"></script>
  <script src="js/herramientas.js"></script>
  <script src="js/backup.js"></script>
  <script src="js/init.js"></script>
</body>
</html>
